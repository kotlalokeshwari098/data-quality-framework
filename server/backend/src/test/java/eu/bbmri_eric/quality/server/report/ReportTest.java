package eu.bbmri_eric.quality.server.report;

import static org.junit.jupiter.api.Assertions.*;

import java.time.LocalDateTime;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

/** Unit tests for the Report entity. */
class ReportTest {

  @Test
  @DisplayName("Should create report with auto-generated UUID")
  void createReport_shouldHaveAutoGeneratedId() {
    Report report = new Report("agent-123");

    assertNotNull(report.getId());
    assertFalse(report.getId().isEmpty());
    assertTrue(
        report
            .getId()
            .matches(
                "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"));
  }

  @Test
  @DisplayName("Should create report with auto-generated timestamp")
  void createReport_shouldHaveAutoGeneratedTimestamp() {
    LocalDateTime beforeCreation = LocalDateTime.now();
    Report report = new Report("agent-123");
    LocalDateTime afterCreation = LocalDateTime.now();

    assertNotNull(report.getTimestamp());
    assertTrue(
        !report.getTimestamp().isBefore(beforeCreation)
            && !report.getTimestamp().isAfter(afterCreation));
  }

  @Test
  @DisplayName("Should create report with specified agent ID")
  void createReport_shouldSetAgentId() {
    String agentId = "agent-123";
    Report report = new Report(agentId);

    assertEquals(agentId, report.getAgentId());
  }

  @Test
  @DisplayName("Should generate unique IDs for different reports")
  void createMultipleReports_shouldHaveUniqueIds() {
    Report report1 = new Report("agent-123");
    Report report2 = new Report("agent-123");

    assertNotEquals(report1.getId(), report2.getId());
  }

  @Test
  @DisplayName("Should allow updating agent ID")
  void setAgentId_shouldUpdateAgentId() {
    Report report = new Report("agent-123");
    String newAgentId = "agent-456";

    report.setAgentId(newAgentId);

    assertEquals(newAgentId, report.getAgentId());
  }

  @Test
  @DisplayName("Should throw exception when creating report with null agent ID")
  void createReport_withNullAgentId_shouldThrowException() {
    IllegalArgumentException exception =
        assertThrows(IllegalArgumentException.class, () -> new Report(null));

    assertEquals("Agent ID cannot be null or empty", exception.getMessage());
  }

  @Test
  @DisplayName("Should throw exception when creating report with empty agent ID")
  void createReport_withEmptyAgentId_shouldThrowException() {
    IllegalArgumentException exception =
        assertThrows(IllegalArgumentException.class, () -> new Report(""));

    assertEquals("Agent ID cannot be null or empty", exception.getMessage());
  }

  @Test
  @DisplayName("Should throw exception when creating report with whitespace-only agent ID")
  void createReport_withWhitespaceAgentId_shouldThrowException() {
    IllegalArgumentException exception =
        assertThrows(IllegalArgumentException.class, () -> new Report("   "));

    assertEquals("Agent ID cannot be null or empty", exception.getMessage());
  }

  @Test
  @DisplayName("Should throw exception when setting null agent ID")
  void setAgentId_withNullAgentId_shouldThrowException() {
    Report report = new Report("agent-123");

    IllegalArgumentException exception =
        assertThrows(IllegalArgumentException.class, () -> report.setAgentId(null));

    assertEquals("Agent ID cannot be null or empty", exception.getMessage());
  }

  @Test
  @DisplayName("Should throw exception when setting empty agent ID")
  void setAgentId_withEmptyAgentId_shouldThrowException() {
    Report report = new Report("agent-123");

    IllegalArgumentException exception =
        assertThrows(IllegalArgumentException.class, () -> report.setAgentId(""));

    assertEquals("Agent ID cannot be null or empty", exception.getMessage());
  }

  @Test
  @DisplayName("Should throw exception when setting whitespace-only agent ID")
  void setAgentId_withWhitespaceAgentId_shouldThrowException() {
    Report report = new Report("agent-123");

    IllegalArgumentException exception =
        assertThrows(IllegalArgumentException.class, () -> report.setAgentId("   "));

    assertEquals("Agent ID cannot be null or empty", exception.getMessage());
  }

  @Test
  @DisplayName("Should be equal to itself")
  void equals_sameObject_returnsTrue() {
    Report report = new Report("agent-123");

    assertSame(report, report);
    assertEquals(report, report);
  }

  @Test
  @DisplayName("Should not be equal to null")
  void equals_nullObject_returnsFalse() {
    Report report = new Report("agent-123");

    assertNotEquals(null, report);
  }

  @Test
  @DisplayName("Should not be equal to different class")
  void equals_differentClass_returnsFalse() {
    Report report = new Report("agent-123");

    assertNotEquals("not a report", report);
  }

  @Test
  @DisplayName("Should not be equal to report with different ID")
  void equals_differentId_returnsFalse() {
    Report report1 = new Report("agent-123");
    Report report2 = new Report("agent-123");

    assertNotEquals(report1, report2);
  }

  @Test
  @DisplayName("Should have consistent hashCode")
  void hashCode_sameObject_returnsConsistentValue() {
    Report report = new Report("agent-123");

    int hashCode1 = report.hashCode();
    int hashCode2 = report.hashCode();

    assertEquals(hashCode1, hashCode2);
  }
}
